var SPIC={getElementXY:function(a){var c,b;elementCopy=a;if(a.offsetParent){c=b=0;do{c+=a.offsetLeft;if(a.style.borderLeftWidth!=""){c+=parseInt(a.style.borderLeftWidth)}else{a.style.borderLeftWidth="0px"}b+=a.offsetTop;if(a.style.borderTopWidth!=""){b+=parseInt(a.style.borderTopWidth)}else{a.style.borderTopWidth="0px"}}while(a=a.offsetParent)}return[c-parseInt(elementCopy.style.borderLeftWidth),b-parseInt(elementCopy.style.borderTopWidth)]},mouseWheel:function(b,d){var a=this;var c=function(e){var f=0;if(!e){e=window.event}if(e.wheelDelta){f=e.wheelDelta/120}else{if(e.detail){f=-e.detail/3}}if(e.preventDefault){e.preventDefault()}e.returnValue=false;if(f){a.wheelCallback(e,a,f)}};if(b.addEventListener){b.addEventListener("DOMMouseScroll",c,false)}if(b.attachEvent){b.attachEvent("onmousewheel",c)}a.wheelCallback=d},getMouseXY:function(b){var a=0,c=0;if(!b){b=window.event}if(b.pageX||b.pageY){a=b.pageX;c=b.pageY}else{if(b.clientX||b.clientY){a=b.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;c=b.clientY+document.body.scrollTop+document.documentElement.scrollTop}}return[a,c]},removeAllChildren:function(a){while(a.firstChild){a.removeChild(a.firstChild)}},addEvent:function(c,a,b){if(c.addEventListener){c.addEventListener(a,b,false)}else{if(c.attachEvent){c.attachEvent("on"+a,b)}}},inArray:function(c,b){for(var a=0;a<c.length;a++){if(c[a]==b){return true}}return false}};function viewer(b){var j=this;if(!viewer.id){viewer.id=1}this.id=viewer.id++;var f,e=null;f=b.image?b.image:null;var c=new Object();c.imageSource=b.imageSource?b.imageSource:null;c.parent=b.parent?b.parent:null;c.replace=b.replace?b.replace:null;c.preLoader=b.preLoader?b.preLoader:viewer.config.preLoader;c.frame=b.frame?b.frame:viewer.config.frame;c.zoomFactor=b.zoomFactor?b.zoomFactor:viewer.config.zoomFactor;c.maxZoom=b.maxZoom?b.maxZoom:viewer.config.maxZoom;c.toolbar=(typeof b.toolbar!=="undefined")?b.toolbar:viewer.config.toolbar;var g=null,h=null,d=[],i=[];var a=new Object();a.zoomLevel=0,a.iZoomLevel=null;a.lastMousePosition=null,a.speed=5;var k=viewer.func;this.getImageElement=function(){return f};this.getDimension=function(){return[f.width,f.height]};this.getPosition=function(){return[parseInt(f.style.left),parseInt(f.style.top)]};this.getImageSrc=function(){return f.src};this.getOriginalDimension=function(){return[d[0],d[1]]};this.getImageStyle=function(){return f.style};this.getFrameElement=function(){return g};this.getFrameDimension=function(){return[g.clientWidth,g.clientHeight]};this.getFramePosition=function(){return SPIC.getElementXY(g)};this.getZoomLevel=function(){return a.zoomLevel};this.getConfig=function(l){return c[l]};this.getStates=function(){return a};this.getToolbar=function(){return e};this.getKeyBindings=function(){return i};this.setDimension=function(m,l){f.style.width=Math.round(m)+"px";f.style.height=Math.round(l)+"px"};this.setPosition=function(l,m){f.style.left=(Math.round(l)+"px");f.style.top=(Math.round(m)+"px")};this.setMouseCursor=function(){var l=j.getDimension();var n=j.getFrameDimension();var m="crosshair";if(l[0]>n[0]&&l[1]>n[1]){m="move"}else{if(l[0]>n[0]){m="e-resize"}else{if(l[1]>n[1]){m="n-resize"}}}f.style.cursor=m};this.setNewImage=function(m,l){if(!m){return}c.imageSource=m;if(typeof l!=="undefined"){c.preLoader=l}f.style.width=f.style.height=null;if(c.preLoader!=null){f.onerror=function(){f.style.maxWidth=(c.frame.max[0]+"px");f.style.maxHeight=(c.frame.max[1]+"px");f.style.position="relative";f.style.display="block";f.style.margin="0 auto";f.onerror=j.onerror;f.onload=j.initImage;f.src=c.imageSource};f.onload=j.preInitImage;f.src=c.preLoader;return}else{f.style.maxWidth=(c.frame.max[0]+"px");f.style.maxHeight=(c.frame.max[1]+"px");f.style.position="relative";f.style.display="block";f.style.margin="0 auto";f.onerror=j.onerror}f.onload=j.initImage;f.src=c.imageSource};this.setZoomProp=function(l,m){if(l==null){l=viewer.config.zoomFactor}c.zoomFactor=1+parseInt(l)/100;if(typeof m=="string"){c.maxZoom=parseInt(m)/100}else{if(m instanceof Array){c.maxZoom[0]=parseInt(m[0]);c.maxZoom[1]=parseInt(m[1])}else{c.maxZoom=parseInt(viewer.config.maxZoom)/100}}};this.getMaxZoomLevel=function(){return k.getMaxZoomLevel(j)};this.isMaxZoom=function(m,l){return k.isMaxZoom(j,m,l)};this.fitToFrame=function(o,l,m,n){return k.fitToFrame(j,o,l,m,n)};this.alignImage=function(p,m,l,q,n,o){return k.alignImage(j,p,m,l,q,n,o)};this.centerImage=function(o,l,m,n){return k.centerImage(j,o,l,m,n)};this.mapPoint=function(n,q,l,p,o,m){return k.mapPoint(j,n,q,l,p,o,m)};this.zoomCalc=function(m,l,n){return k.zoomCalc(j,m,l,n)};this.zoomCalcPercentage=function(m,l,n){return k.zoomCalcPercentage(j,m,l,n)};this.resetZoom=function(){k.resetZoom(j)};this.zoomTo=function(m,l,n){return k.zoomTo(j,m,l,n)};this.relativeZoomTo=function(n,l,m){return k.relativeZoomTo(j,n,l,m)};this.zoomToPercentage=function(m,l,n){return k.zoomToPercentage(j,m,l,n)};this.moveBy=function(l,m){k.moveBy(j,l,m)};this.moveTo=function(l,m){k.moveTo(j,l,m)};this.visible=function(l){k.visible(j,l)};this.addKeyBinding=function(n,l,m){if(l instanceof Array&&typeof m=="function"){i[n]={keyCodes:l,call:m};return true}return false};this.removeKeyBinding=function(m){var l=!!(i[m]);if(i[m]){delete i[m]}return l};this.onerror=function(){k.onerror(j)};this.onmousewheel=function(l,m,n){k.onmousewheel(j,l,m,n)};this.onmousemove=function(l){k.onmousemove(j,l)};this.onmouseup_or_out=function(l){k.onmouseup_or_out(j,l)};this.onmousedown=function(l){k.onmousedown(j,l)};this.onkeypress=function(l){k.onkeypress(j,l)};this.onkeyup=function(l){k.onkeyup(j,l)};this.onload=function(l){if(k.onload!=null){k.onload(j)}};this.preInitImage=function(){if(c.preLoader!=null){f.style.left=((g.clientWidth-f.width)/2)+"px";f.style.top=((g.clientHeight-f.height)/2)+"px"}f.onerror=j.onerror;f.onload=j.initImage;f.src=c.imageSource};this.initImage=function(){f.style.maxWidth=f.style.maxHeight=null;f.style.width=f.style.height="auto";d[0]=f.width;d[1]=f.height;f.style.position="absolute";var p=c.frame.max[0],l=c.frame.max[1];var n=j.fitToFrame(d[0],d[1],p,l);j.setDimension(n[0],n[1]);if(c.frame.autoFit[0]==true){p=n[0];if(c.frame.min&&n[0]<c.frame.min[0]){p=c.frame.min[0]}g.style.width=(Math.round(p)+"px")}if(c.frame.autoFit[1]==true){var l=n[1];if(c.frame.min&&n[1]<c.frame.min[1]){l=c.frame.min[1]}g.style.height=(Math.round(l)+"px")}var o=j.alignImage(n[0],n[1],0,0);j.setPosition(o[0],o[1]);j.setMouseCursor();h=new SPIC.mouseWheel(f,j.onmousewheel);SPIC.addEvent(f,"mousedown",j.onmousedown);SPIC.addEvent(g,"keypress",j.onkeypress);SPIC.addEvent(g,"keyup",j.onkeyup);var m=function(){var y=function(){j.resetZoom()};var A=function(){var F=j.getFrameDimension();j.relativeZoomTo(+1,F[0]/2,F[1]/2)};var z=function(){var F=j.getFrameDimension();j.relativeZoomTo(-1,F[0]/2,F[1]/2)};if(c.toolbar&&!e){e=new viewer.func.toolbar(j);var x=e.getToolbarDiv();var u=function(F){var G;if(F.keyCode){G=F.keyCode,F.returnValue=false}else{if(F.which){G=F.which,F.preventDefault()}}return G==13};e.appendButton("Zoom in","in.png",A);e.appendButton("Zoom out","out.png",z);e.appendButton("Center image","center.png",y);var r=document.createElement("span");var B=document.createElement("div");B.className="helpText";B.tabIndex="1";B.style.display="none";B.innerHTML='<h5 style="color:#40C0FF; font-size:12px; margin:2px 0;">How to use the image viewer?</h5>';B.innerHTML=B.innerHTML+"Zooming<hr> Use the mouse wheel or the toolbar to zoom in/out. You can also zoom IN using '+','x' or '=' keys and zoom OUT using '-' or 'z' keys using the keyboard.";B.innerHTML=B.innerHTML+"<br><br>Panning<hr> Click and drag the mouse to pan the image or use 'w','s','a' and 'd' keys for moving up,down,left and right respectively.<br>Alternatively you can use the arrow image buttons to pan the image.";B.innerHTML=B.innerHTML+"<br><br>Center Image<hr> Click on the 'Center image' icon on the toolbar or press 'c' to center image.";B.onblur=function(){setTimeout(function(){B.style.display="none"},100)};B.onkeypress=function(F){F=F||window.event;var G=F.which||F.keyCode;if(G==27){r.focus()}};var t=function(F){F=F||window.event;if(F.type=="keypress"){if(!u(F)){return}}if(B.style.display=="none"){B.style.display="block";B.focus()}else{B.style.display="none"}};r.className="helpButton";r.title="Help";r.tabIndex="1";r.onclick=r.onkeypress=t;x.appendChild(r);var E=document.createElement("img");E.className="movement-controls";E.src=viewer.config.toolbarImages+"/movement-controls.png";E.useMap="#controls"+j.id;var s=document.createElement("map");s.name="controls"+j.id;var w=document.createElement("area");w.shape="rect";w.coords="17,1,31,17";w.tabIndex="-1";w.style.cursor="pointer";w.onclick=function(){var F=j.getFrameDimension();j.moveBy(0,F[1]*0.1)};s.appendChild(w);var D=document.createElement("area");D.shape="rect";D.coords="17,31,31,47";D.tabIndex="-1";D.style.cursor="pointer";D.onclick=function(){var F=j.getFrameDimension();j.moveBy(0,-1*F[1]*0.1)};s.appendChild(D);var v=document.createElement("area");v.shape="rect";v.coords="1,17,17,31";v.tabIndex="-1";v.style.cursor="pointer";v.onclick=function(){var F=j.getFrameDimension();j.moveBy(F[0]*0.1,0)};s.appendChild(v);var C=document.createElement("area");C.shape="rect";C.coords="31,17,47,31";C.tabIndex="-1";C.style.cursor="pointer";C.onclick=function(){var F=j.getFrameDimension();j.moveBy(-1*F[0]*0.1,0)};s.appendChild(C);x.appendChild(B);g.appendChild(x);g.appendChild(E);g.appendChild(s)}j.addKeyBinding("center",["c","C"],y);j.addKeyBinding("zoomin",["=","+","x","X"],A);j.addKeyBinding("zoomout",["-","z","Z"],z);var q=function(F){var G=j.getDimension();F=j.alignImage(G[0],G[1],F[0],F[1]);j.setPosition(F[0],F[1]);a.speed+=2};j.addKeyBinding("moveleft",["a","A"],function(){var F=j.getPosition();F[0]+=a.speed;q(F)});j.addKeyBinding("moveup",["w","W"],function(){var F=j.getPosition();F[1]+=a.speed;q(F)});j.addKeyBinding("moveright",["d","D"],function(){var F=j.getPosition();F[0]-=a.speed;q(F)});j.addKeyBinding("movedown",["s","S"],function(){var F=j.getPosition();F[1]-=a.speed;q(F)})};m();j.onload()};j.setZoomProp(c.zoomFactor,c.maxZoom);g=document.createElement("div");g.className="viewer-frame";g.style.width=(c.frame.max[0]+"px");g.style.height=(c.frame.max[1]+"px");g.tabIndex=1;if(f!=null){if(c.parent!=null){f.parentNode.removeChild(f);c.parent.appendChild(g)}else{if(c.replace!=null){f.parentNode.removeChild(f);c.replace.parentNode.replaceChild(g,c.replace)}else{f.parentNode.replaceChild(g,f)}}c.imageSource=f.src;f.style.margin=f.style.padding="0";f.style.borderWidth="0px";f.style.position="absolute";f.style.zIndex=3;g.appendChild(f);if(c.imageSource!=null){j.preInitImage()}else{j.initImage()}}else{if(c.parent!=null){c.parent.appendChild(g)}else{if(c.replace!=null){c.replace.parentNode.replaceChild(g,c.replace)}}f=document.createElement("img");f.style.position="absolute";f.style.zIndex=3;g.appendChild(f);j.setNewImage(c.imageSource)}}viewer.config=new Object();viewer.config.preLoader=null;viewer.config.frame={max:[400,250],min:[100,100],autoFit:[true,false]};viewer.config.zoomFactor="20%";viewer.config.maxZoom="300%";viewer.config.toolbar=true;viewer.config.toolbarImages="images/toolbar";viewer.func=new Object();viewer.func.getMaxZoomLevel=function(a){var e=a.getOriginalDimension();var c=a.fitToFrame(e[0],e[1]);var b=a.getConfig("zoomFactor");for(var d=0;!a.isMaxZoom(c[0],c[1]);d++){c[0]*=b,c[1]*=b}return(d>0)?(d-1):0};viewer.func.isMaxZoom=function(d,e,a){if(typeof e!="number"||typeof a!="number"){var c=d.getDimension();e=c[0],a=c[1]}var f=d.getOriginalDimension();var b=d.getConfig("maxZoom");if(typeof b=="number"){return((e/f[0])>b||(a/f[1])>b)}else{if(b instanceof Array){return(e>b[0]||a>b[1])}}};viewer.func.fitToFrame=function(i,b,h,g,d){if(typeof b!="number"||typeof h!="number"){var c=i.getOriginalDimension();b=c[0],h=c[1]}var f=i.getFrameDimension(),e,a;if(typeof g=="number"){f[0]=g}if(typeof d=="number"){f[1]=d}if(f[0]>b){f[0]=b}if(f[1]>h){f[1]=h}e=f[0];a=Math.round((e*h)/b);if(a>(f[1])){a=f[1];e=Math.round((a*b)/h)}return[e,a]};viewer.func.alignImage=function(i,a,h,f,d,e,b){if(typeof a!="number"||typeof h!="number"){var g=i.getDimension();a=g[0],h=g[1]}if(typeof f!="number"||typeof d!="number"){var g=i.getPosition();f=g[0],d=g[1]}var c=i.getFrameDimension();if(typeof e=="number"){c[0]=e}if(typeof b=="number"){c[1]=b}if(a<=c[0]){f=Math.round((c[0]-a)/2)}if(h<=c[1]){d=Math.round((c[1]-h)/2)}if(a>c[0]){if(f>0){f=0}else{if((f+a)<c[0]){f=c[0]-a}}}if(h>c[1]){if(d>0){d=0}else{if((d+h)<c[1]){d=c[1]-h}}}return[f,d]};viewer.func.centerImage=function(i,a,h,e,b){if(typeof a!="number"||typeof h!="number"){var g=i.getDimension();a=g[0],h=g[1]}var c=i.getFrameDimension();if(typeof e=="number"){c[0]=e}if(typeof b=="number"){c[1]=b}var f=Math.round((c[0]-a)/2);var d=Math.round((c[1]-h)/2);return[f,d]};viewer.func.mapPoint=function(d,c,g,a,f,e,b){return[(e/c*a),(b/g*f)]};viewer.func.zoomCalc=function(l,d,k,j){var h=l.getFrameDimension();if(d<0||k<0||j<0||k>=h[0]||j>=h[1]){return false}var c=l.getOriginalDimension();var e=l.fitToFrame(c[0],c[1]);var b=l.getConfig("zoomFactor");for(var f=d;f>0;f--){e[0]*=b,e[1]*=b}var a=l.getDimension();var g=l.getPosition();g[0]-=((k-g[0])*((e[0]/a[0])-1)),g[1]-=((j-g[1])*((e[1]/a[1])-1));g=l.alignImage(e[0],e[1],g[0],g[1]);return[e,g]};viewer.func.zoomCalcPercentage=function(m,i,j,h){var b=m.getOriginalDimension();if(i<=0||j<0||h<0||j>=b[0]||h>=b[1]){return false}var d=m.fitToFrame(b[0],b[1]);var l=[b[0]*i/100,b[1]*i/100];var e=function(){return(d[0]>l[0]||d[1]>l[1])};var k=function(){return(d[0]==l[0]||d[1]==l[1])};var a=m.getConfig("zoomFactor");for(var c=0;!m.isMaxZoom(d[0],d[1])&&!(e()||k());c++){d[0]*=a,d[1]*=a}var g=m.getFrameDimension();var f=[-l[0]/b[0]*j+(g[0]/2),-l[1]/b[1]*h+(g[1]/2)];f=m.alignImage(l[0],l[1],f[0],f[1]);return[l,f,c,k()]};viewer.func.resetZoom=function(b){var c=b.getStates();var e=b.getOriginalDimension();var d=b.fitToFrame(e[0],e[1]);var a=b.alignImage(d[0],d[1],0,0);b.setDimension(d[0],d[1]);b.setPosition(a[0],a[1]);b.setMouseCursor();c.zoomLevel=0};viewer.func.zoomTo=function(c,d,b,h){var e=c.getStates();var g=c.zoomCalc(d,b,h);if(!g){return false}var f=g[0];var a=g[1];if((d>e.zoomLevel&&!c.isMaxZoom(f[0],f[1]))||d<=e.zoomLevel){e.zoomLevel=d;c.setDimension(f[0],f[1]);c.setPosition(a[0],a[1]);c.setMouseCursor()}else{return false}return true};viewer.func.relativeZoomTo=function(b,f,a,e){var d=b.getStates();var c;if(d.iZoomLevel!==null){if(f>0){c=Math.ceil(d.iZoomLevel)+f-1}else{c=Math.floor(d.iZoomLevel)+f+1}d.iZoomLevel=null}else{c=d.zoomLevel+f}return b.zoomTo(c,a,e)};viewer.func.zoomToPercentage=function(d,c,b,h){var g=d.zoomCalcPercentage(c,b,h);if(!g){return false}var f=g[0];var a=g[1];var e=d.getStates();if(!g[3]){e.iZoomLevel=g[2]-0.5}d.setDimension(f[0],f[1]);d.setPosition(a[0],a[1]);d.setMouseCursor();return true};viewer.func.moveBy=function(c,b,e){var a=c.getPosition();var d=c.getDimension();a=c.alignImage(d[0],d[1],a[0]+b,a[1]+e);c.setPosition(a[0],a[1])};viewer.func.moveTo=function(d,c,h){var g=d.getFrameDimension();var f=d.getDimension();var b=-(c-g[0]/2),e=-(h-g[1]/2);var a=d.alignImage(f[0],f[1],b,e);d.setPosition(a[0],a[1])};viewer.func.visible=function(b,a){b.getFrameElement().style.display=(a?"block":"none")};viewer.func.toolbar=function(a){var c=this;var b=document.createElement("div");b.className="toolbar";this.getToolbarDiv=function(){return b};this.createButton=function(f,e,g){var d=document.createElement("img");d.className="toolbarButton";d.title=f;d.tabIndex="-1";d.src=viewer.config.toolbarImages+"/"+e;d.onclick=g;return d};this.appendButton=function(f,e,g){var d=c.createButton(f,e,g);b.appendChild(d);return d}};viewer.func.onmousewheel=function(b,c,f,g){b.getFrameElement().focus();if(c.preventDefault){c.preventDefault()}c.returnValue=false;var e=b.getStates();var a=SPIC.getMouseXY(c);var d=SPIC.getElementXY(b.getFrameElement());b.relativeZoomTo(g,a[0]-d[0],a[1]-d[1])};viewer.func.onmousemove=function(b,c){c=c||window.event;if(c.preventDefault){c.preventDefault()}c.returnValue=false;var d=b.getStates();var f=SPIC.getMouseXY(c);var a=b.getPosition();a[0]+=(f[0]-d.lastMousePosition[0]),a[1]+=(f[1]-d.lastMousePosition[1]);d.lastMousePosition=f;var e=b.getDimension();a=b.alignImage(e[0],e[1],a[0],a[1]);b.setPosition(a[0],a[1])};viewer.func.onmouseup_or_out=function(a,b){b=b||window.event;if(b.preventDefault){b.preventDefault()}b.returnValue=false;var c=a.getImageElement();c.onmousemove=c.onmouseup=c.onmouseout=null;c.onmousedown=a.onmousedown};viewer.func.onmousedown=function(a,b){a.getFrameElement().focus();b=b||window.event;if(b.preventDefault){b.preventDefault()}b.returnValue=false;var c=a.getImageElement();a.getStates().lastMousePosition=SPIC.getMouseXY(b);c.onmousemove=a.onmousemove;c.onmouseup=c.onmouseout=a.onmouseup_or_out};viewer.func.onkeypress=function(b,d){d=d||window.event;var e=d.which||d.keyCode;if(e==9){return e}e=String.fromCharCode(e);var c=b.getKeyBindings();for(var a in c){if(SPIC.inArray(c[a].keyCodes,e)){c[a].call(b,d);if(d.preventDefault){d.preventDefault()}d.returnValue=false}}};viewer.func.onkeyup=function(a,b){a.getStates().speed=5};viewer.func.onerror=function(a){var d=a.getFrameElement();a.getImageStyle().display="none";if(typeof a.errorMessage=="undefined"||a.errorMessage==null){var c=document.createElement("span");c.style.position="absolute";c.style.verticalAlign="middle";c.style.textAlign="center";c.innerHTML="Error: Cannot load image<br />";var b=document.createElement("input");b.type="button";b.value="Try again";b.onclick=function(){d.removeChild(c);a.getImageStyle().display="block";a.setNewImage(a.getConfig("imageSource"))};c.appendChild(b);a.errorMessage=c}d.appendChild(a.errorMessage);a.errorMessage.style.left=(((d.clientWidth-a.errorMessage.clientWidth)/2)+"px");a.errorMessage.style.top=(((d.clientHeight-a.errorMessage.clientHeight)/2)+"px")};viewer.func.onload=null;